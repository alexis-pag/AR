<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>MindAR Explosion</title>

  <script src="https://cdn.jsdelivr.net/npm/aframe@1.6.0/dist/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.1.5/dist/mindar-image-aframe.prod.js"></script>

  <style>
    body, html {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: black;
    }

    #mindar-video {
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      width: 100vw !important;
      height: 100vh !important;
      object-fit: cover !important;
      z-index: -2 !important;
    }

    canvas {
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      width: 100vw !important;
      height: 100vh !important;
      z-index: 0 !important;
      background: transparent !important;
    }
  </style>

  <script>
    AFRAME.registerComponent("explode-on-detect", {
      init: function () {
        const sceneEl = this.el.sceneEl;

        sceneEl.addEventListener("targetFound", () => {
          this.startExplosion();
        });
      },

      startExplosion: function () {
        const parts = [
          { id: "back", to: "-20.15299 4.74877 -64.67917" },
          { id: "Left", to: "-41.10108 62.18591 -69.24553" },
          { id: "Right", to: "-99.76148 21.65531 21.74075" },
          { id: "Batteries", to: "-88.80972 35.7123 9.96086" },
          { id: "Open", to: "-53.66647 18.64757 -44.24839" },
          { id: "Speaker", to: "-95.89407 11.82067 7.85191" },
          { id: "Led", to: "-69.96779 77.85118 -19.66102" },
          { id: "partie-avant", to: "-117.78422 29.11701 -19.38373" },
          { id: "bas", to: "-69.65366 -18.19764 -19.1577" }
        ];

        parts.forEach(p => {
          const el = document.getElementById(p.id);

          const originalPos = el.getAttribute("position");

          el.setAttribute("animation__explode", {
            property: "position",
            to: p.to,
            dur: 800,
            easing: "easeOutQuad"
          });

          el.setAttribute("animation__return", {
            property: "position",
            to: `${originalPos.x} ${originalPos.y} ${originalPos.z}`,
            dur: 800,
            delay: 1000,
            easing: "easeInQuad"
          });
        });
      }
    });
  </script>
</head>

<body>
  <a-scene
    mindar-image="imageTargetSrc: targets.mind; maxTrack: 1;"
    color-space="sRGB"
    renderer="colorManagement: true, physicallyCorrectLights: false"
    vr-mode-ui="enabled: false"
    device-orientation-permission-ui="enabled: false"
  >
    <a-assets>
      <a-asset-item id="back" src="back.obj"></a-asset-item>
      <a-asset-item id="left" src="left.obj"></a-asset-item>
      <a-asset-item id="right" src="right.obj"></a-asset-item>
      <a-asset-item id="Batteries" src="Batteries.obj"></a-asset-item>
      <a-asset-item id="Open" src="Open.obj"></a-asset-item>
      <a-asset-item id="Speaker" src="Speaker.obj"></a-asset-item>
      <a-asset-item id="Led" src="Led.obj"></a-asset-item>
      <a-asset-item id="partie-avant" src="partie-avant.obj"></a-asset-item>
      <a-asset-item id="bas" src="bas.obj"></a-asset-item>
    </a-assets>

    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    <!-- Le modèle apparaît UNIQUEMENT quand le marker est détecté -->
    <a-entity mindar-image-target="targetIndex: 0" explode-on-detect>

      <a-entity id="back" obj-model="obj: #back"
        position="-20.15299 4.74877 -54.67917"
        rotation="0 90 0" scale="1 1 1"
        material="color: #ffff80"></a-entity>

      <a-entity id="Left" obj-model="obj: #left"
        position="-31.10108 62.18591 -69.24553"
        rotation="0 0 90" scale="1 1 1"
        material="color: #8080c0"></a-entity>

      <a-entity id="Right" obj-model="obj: #right"
        position="-89.76148 21.65531 21.74075"
        rotation="0 0 -90" scale="1 1 1"
        material="color: #8000ff"></a-entity>

      <a-entity id="Batteries" obj-model="obj: #Batteries"
        position="-78.80972 35.7123 9.96086"
        rotation="-89.9996 -88.5827 0" scale="1 1 1"
        material="color: #80ffff"></a-entity>

      <a-entity id="Open" obj-model="obj: #Open"
        position="-43.66647 18.64757 -44.24839"
        rotation="0 90 0" scale="1 1 1"
        material="color: #ffff00"></a-entity>

      <a-entity id="Speaker" obj-model="obj: #Speaker"
        position="-85.89407 11.82067 7.85191"
        rotation="0 -90 0" scale="1 1 1"
        material="color: #ff8000"></a-entity>

      <a-entity id="Led" obj-model="obj: #Led"
        position="-59.96779 77.85118 -19.66102"
        rotation="0 0 0" scale="1 1 1"
        material="color: #0080c0"></a-entity>

      <a-entity id="partie-avant" obj-model="obj: #partie-avant"
        position="-107.78422 29.11701 -19.38373"
        rotation="-90 90 0" scale="1 1 1"
        material="color: #ff0000"></a-entity>

      <a-entity id="bas" obj-model="obj: #bas"
        position="-59.65366 -18.19764 -19.1577"
        rotation="0 90 0" scale="1 1 1"
        material="side: double; color: #ff80c0"></a-entity>

    </a-entity>
  </a-scene>
</body>
</html>
